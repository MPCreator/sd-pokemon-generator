schema: '2.0'
stages:
  set_up_diffusers:
    cmd: "git clone --depth 1 --branch v0.14.0 https://github.com/huggingface/diffusers.git\
      \ diffusers\npip3.10 install -r \"diffusers/examples/dreambooth/requirements.txt\"\
      \naccelerate config default\n"
    outs:
    - path: diffusers
      md5: 24d2dc4cd0e74c32b967fbc7fbc1c25f.dir
      size: 5998474
      nfiles: 545
  scrape_pokemon_images:
    cmd: python3 src/scrape_pokemon_images.py --params params.yaml
    deps:
    - path: src/scrape_pokemon_images.py
      md5: 9b2c189c9af8b0cff17f9e5d28af2a52
      size: 1266
    params:
      params.yaml:
        base:
          train_pokemon_type: all
    outs:
    - path: data/external/pokemon
      md5: 6b41f549b3211b04a1597c81fc4be6c6.dir
      size: 130512085
      nfiles: 1008
  download_pokemon_stats:
    cmd: kaggle datasets download -d brdata/complete-pokemon-dataset-gen-iiv -f Pokedex_Cleaned.csv
      -p data/external/
    outs:
    - path: data/external/Pokedex_Cleaned.csv
      md5: eb037b3ce0411f8c0d47483918114b33
      size: 58035
  resize_pokemon_images:
    cmd: python3 src/resize_pokemon_images.py --params params.yaml
    deps:
    - path: data/external/Pokedex_Cleaned.csv
      md5: eb037b3ce0411f8c0d47483918114b33
      size: 58035
    - path: data/external/pokemon
      md5: 6b41f549b3211b04a1597c81fc4be6c6.dir
      size: 130512085
      nfiles: 1008
    - path: src/resize_pokemon_images.py
      md5: 9c8c870ff9834b57b4153802d872174a
      size: 2559
    outs:
    - path: data/processed/pokemon
      md5: a26f62405388119e770a1f2e710c3535.dir
      size: 146096519
      nfiles: 1003
  train_lora:
    cmd: "accelerate launch --mps \"diffusers/examples/dreambooth/train_dreambooth_lora.py\"\
      \ --pretrained_model_name_or_path=runwayml/stable-diffusion-v1-5 --instance_data_dir=data/processed/pokemon\
      \ --output_dir=models/pkmnlora --instance_prompt='a pkmnlora pokemon' --resolution=512\
      \ --train_batch_size=1 --gradient_accumulation_steps=1 --checkpointing_steps=100\
      \ --learning_rate=0.0001 --lr_scheduler='constant' --lr_warmup_steps=0 --max_train_steps=500\
      \ --seed=0\n"
    deps:
    - path: data/processed/pokemon
      md5: a26f62405388119e770a1f2e710c3535.dir
      size: 146096519
      nfiles: 1003
    - path: diffusers
      md5: 24d2dc4cd0e74c32b967fbc7fbc1c25f.dir
      size: 5998474
      nfiles: 545
    outs:
    - path: models/pkmnlora
      md5: ab32c2c36406607bdbb6e3b9577a0aae.dir
      size: 69151821
      nfiles: 24
  generate_text_to_image:
    cmd: python3 src/generate_text_to_image.py --params params.yaml
    deps:
    - path: models/pkmnlora
      md5: ab32c2c36406607bdbb6e3b9577a0aae.dir
      size: 69151821
      nfiles: 24
    - path: src/generate_text_to_image.py
      md5: 6687364f6ee6fac81e274f3a0a9abf21
      size: 2968
    outs:
    - path: outputs
      md5: 7a0abaab8f74118b968a71771e829349.dir
      size: 390373
      nfiles: 1
